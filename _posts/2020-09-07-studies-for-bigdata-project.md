---
layout: post
title: "빅데이터 프로젝트를 위한 사전 공부"
tags: [Self Study, study, bigdata, project]
excerpt_separator: <!--more-->

---

# 빅데이터 프로젝트를 위한 공부

## 데이터 분석 및 시각화

### 개요

현재 수많은 기어베서 매출을 극대화하기 위해 추천 시스템을 도입하고 있다. 대표적인 예로 Netflix에서 시청되는 영화의 80%, Youtube에서 재생되는 동영상의 60%, Amazon 전체 매출의 35%가 추천 시스템에 의해서 발생한다. 경제적 산업적 파급효과가 막대한 추천 시스템의 중요성을 일찍이 인지한 많은 기업들의 대량의 사용자 로그 데이터를 활용한 추천 시스템 연구를 10년 이상 지속해오고 있다.

서비스 사용자의 관점에서 추천시스템은 수천만개의 컨텐츠 및 제품에 대한 탐색 시간을 줄여주고 자신의 과거 기록이나 작성한 정보, 다른 유저들의 행동패턴 등을 통해 적합한 후보들을 골라준다는 이점이 있다. 이렇게 적합한 후보를 제시함으로써 기업은 사용자의 편의성을 극대화 할 수 있고, 이는 더 많은 서비스 구독이나 판매로 이어져 결과적으로는 서비스 제공자와 이용자 모두 이득을 보는 시스템이다. 

### EDA(Exploratory Data Analysis)

데이터 분석 및 시각화를 위해 다음의 과정을 거친다.

* Pandas 라이브러리를 사용하여 주어진 데이터를 정제하고 통계적 분석을 수행
* Matplotlib, Folium 라이브러리를 사용하여 데이터를 시각화

이 과정을 탐색적 데이터 분석(EDA) 이라고 하며 어떤 목표를 가지고 데이터분석을 진행하던지에 상관없이 1. 주어진 데이터에 어떤 값들이 있는지 2.값들은 수치로 표현되어 있는지 혹은 카테고리 값으로 표현되어 있는지 3. 특성들 사이에는 어떤 관계가 있는지 데이터를 이해하는 단계이다.

주어진 데이터의 특성들을 조합해 새로운 특성값을 만들어 내서 사용해야 하므로 데이터와 알고리즘에 대한 깊은 이해가 필요하다.

### Python & Pandas DataFrame

#### Python

파이썬은 매우 간결하면서도 강력한 기능을 가진 프로그래밍 언어이다. Pandas, Numpy, Scipy, Scikit-learn등의 라이브러리를 사용하여 간편하게 수치 연산과 데이터 분석을 할 수 있으며, 다양한 빅데이터 알고리즘 또한 미리 구현되어 있어 데이터 과학에 적합한 언어라 할 수 있다. 구글의 Tensorflow나 Facebook의 PyTorch를 활용하여 딥러닝 분야에서도 파이썬이 널리 사용되고 있으므로 데이터 과학자나 머신 러닝 엔지니어를 지망하는 개발자라면 필수적으로 알아야 하는 언어이다.

#### Pandas

Pandas는 데이터 정제 및 분석을 위해 사용하는 파이썬 라이브러리이다. DataFrame 이라는 관계형 데이터베이스의 테이블을 닮은 2차원 데이터 구조를 주로 사용하며, 이 데이터 구조에 대하여 여러가지 처리를 할 수 있는 기능을 갖추고 있다. Pandas의 주요기능은 C로 구현되어 있기 때문에 대규모 데이터를 다룰 떄의 성능이 좋으며, Numpy나 Matplotlib과 같은 타 파이썬 라이브러리들과의 호환성도 매우 높아 파이썬을 이용한 데이터 분석의 기초가 되는 라이브러리이다.

사용하기 위해서는 설치를 하고 import가 필요하다

```python
# 터미널에서 pip install pandas
import pandas as pd
```

##### Series

Series는 가장 간단한 1차원 자료구조로 배열/ 리스트와 같은 일련의 시퀀스 데이터를 받아들인다. 별도의 인덱스 레이블을 지정하지 않으면 자동으로 0부터 시작하는 디폴트 정수 인덱스를 사용한다.

```python
import pandas as pd
data = [1, 2, 3, 4, 5]
s = pd.Series(data)

```

##### DataFrame

DataFrame은 2차원 자료구조로 행과 열이 있는 테이블 데이터를 받아들인다. 아래 예제는 그 방법 중 한가지로 열(column)을 dict의 key로, 행(row)을 dict의 value로 한 딕셔너리형 데이터를 pd.DataFrame()을 사용하여 pandas의 DataFrame자료구조로 변환한 예이다.

```python
import pandas as pd
data = {
  'year': [2016, 2017, 2018],
  'GDP rate': [2.8, 3.1, 4.0],
  'GDP': ['1,637M', '1.73M', '1.83M']
}
df = pd.DataFrame(data)
```

##### Panel

Panel은 3차원 자료구조로 Axis 0, Axis 1, Axis 2 (각각 items, major_axis, minor_axis)의 세개의 축을 가지고 있다. Axios 0 은 그 한 요소가 2차원의 DataFrame에 해당되며, Axis 1 은 DataFrame의 행(row)에 해당되고, Axis 2 는 DataFrame의 열(column)에 해당된다. 

아래 예제는 numpy를 사용하여 3차원 난수를 발생시킨 후, 이를 pandas.Panel()에 적용한 예이다. 출력 결과를 보면 2 x 3 x 4 `(items * major_axis * minor_axis)` 크기의 Panel객체가 생성되었음을 알 수 있다. `p[0]`르ㄹ 출력해보면 Axis 0 의 첫번쨰 요소인 DataFrame이 출력된다.

```python
import pandas as pd
import numpy as np

data = np.random.rand(2, 3, 4)
p = pd.Panel(data)
print(p) # 3차원 객체 Panel
print(p[0]) # 객체의 items
```

##### 데이터 액세스

Pandas에서 Series, DataFrame, Panel 등의 자료구조를 만든 후, 다양한 방법을 통해 데이터에 접근할 수 있다. 가장 간단한 방법으로 pandas 자료구조에 대해 인덱싱 혹은 속성(Attribute)을 사용하는 것인데, 예를 들어 위에서 생성한 DataFrame인 df에 대해 year행을 가져오기 위해서는 

```python
df['year'] # 해당 column에 있는 값들을 가져옴
df.year # 위와 동일한 표현
```

또한 불린 인덱싱(Boolean indexing)을 사용하여 특정 조건의 데이터를 필터링 할 수도 있다. 예를 들어 2016년 이후의 데이터만 필터링 하기 위해서는 

```python
df[ df['year'] > 2016] # Boolean indexing
```

또한 해당 컬럼의 총합 또는 평균도 간단하게 구할 수 있다.

```python
gdp_sum = df['GDP rate'].sum()
gdp_avg = df['GDP rate'].mean()
print(sum, avg) # 8.9, 2.97
```

데이터의 양이 많은 경우 df.head()함수를 사용하면 처음 5개를 표시해주며, df.tail()함수를 사용하면 마찬가지로 마지막 5개 row를 표시해 준다.

#### Matplotlib

Matplotlib은 데이터 시각화를 위해 사용되는 파이썬 라이브러리로, 다양한 형태의 그래프를 손쉽게 그릴 수 있으며, 통계 기능과 색 테마를 지원하는 Seaborn 라이브러리를 함께 활용하면 더욱 간편하게 그래프를 그릴 수 있다. 

아래 예제는 csv파일을 pandas를 통해 읽어 들인 후, amtplotlib을 통해 bar차트를 그리는 예제이다.

```python
%matplotlib inline
import pandas as pd
from amtplotlib import pyplot as plt

df = pd.read_csv('test.csv')
plt.bar(df.ID, df['column name'])
plt.show()
```



#### Folium

Folium은 지도 데이터를 사용하여 위치 정보를 시각화하는 데에 사용되는 파이썬 라이브러리이다.









## 기본 추천 시스템 구축

추천시스템의 기본이 되는 모델인 컨텐츠 기반 필터링(Content Based Filtering; CBF)과 협업 필터링(Collaborative Filtering; CF) 알고리즘을 학습한다.

### 

### 협업 필터링 (Collaborative Filtering, CF)

다른 사람이 남긴 기록(좋아요, 매긴 평점, 남긴 리뷰, 기타)을 기반으로 하는 추천시스템으로, 협업 필터링을 활용한 추천에서는 깊은(Deep)모델보다는 얕은 모델을이 아직까지는 우위를 점하고 있다. 

#### user-based collaborative filtering

말 그래도 비슷한 유저를 골라내는 것으로, 어떤 유저와 비슷한 성향 또는 취향을 가진 유저들을 찾아내어 그 유저들의 정보를 기반으로 해당 유저에게 맞춤 정보를 제공한다.

#### item-based collaborative filtering

하나의 아이템을 선택 또는 평가한 유저들을 정리하고 그 아이템에 대한 평가가 유사한 유저들이 선택한 다른 아이템들을 해당 유저에게 추천하는 방법. 아이템의 특성을 어떻게 정의하느냐에 따라 같은 부류로 묶이는 아이템들이 달라지므로 여러 특성을 적용해 보고 효과가 좋은 특성을 찾아내는 것이 중요하다.

#### 행렬 분해(Matrix factorization)

행렬 분해랑 말 그래도 매트릭스를 분해하는 방법이다. 유저가 어떤 컨텐츠를 소비했는지를 유저-컨텐츠 매트릭스로 표현한 후 이 매트릭스를 랭크가 작은 두개의 매트릭스로 나누고, 이렇게 두 개로 나눈 매트릭스의 곱이 원래의 매트릭스와 비슷하게 나오도록 학습하는 방법이다. 원래의 유저-컨텐츠의 랭크보다 적은 숫자로 인풋을 학습하는 것이기 때문에, 압축하고 복원하는 과정에서 원래 유저가 소비하지 않았던 컨텐츠에 대한 숫자들이 나오게 되는데 이 숫자들을 유저에 대한 해당 컨텐츠의 **계산된 선호도** 라고 볼 수 있다. 

#### 오토인코더(Autoencoder)

모델에서 더 다양한 정보를 얻고 싶을 경우 위의 행렬분해보다 더 유연한 오토인코더를 사용할 수 있다. 오토인코더는 행렬 분해와 비슷하게 입력 데이터를 원래의 차원(dimension)보다 적은 데이터로 줄인 후에, 변환한 데이터를 기반으로 원래의 데이터를 복원하는 구조로 되어 있다. 

오토인코더가 학습하고 데이터를 생성하는 과정은 한 문장의 설명을 듣고 몽타주를 그리는 과정과 유사하다. 몽타주는 초상화와 다르게 제한된 정보를 이용해 최대한 원본에 가깝게 그려야 하기 때문에 제공되는 정보는 높은 가치가 있어야 한다. 또한 설명을 듣고 그림을 그리는 사람의 실력도 좋아야 한다. 오토인코더는 몽타주를 그리는 과정에서 한 문장을 설명하는 사람과 이를 듣고 몽타주를 그리는 사람이 서로 합을 맞춰가는 과정과 유사핟. 몽타주 대상을 설명하는 문장에 최대한 많은 정보를 담고, 결과물인 몽타주가 최대한 원본에 가깝도록 학습해 나가는 모델이다. 설명을 할 때 강제로 정보를 축약해서 표현하고 이를 복원하는 과정에서 **원본 값이 그대로 나오기보다 원본에서 가장 중요한 핵심 값들이 나오는 방식**이라고 할 수 있다. 

협업 필터링의 경우 기본적으로 과거의 선택을 기반으로 미래의 선택을 추천 하는 것으로 새로운 아이템이 생겼을 경우 이 아이템을 어떤 유저에게 추천해야할 지 결정하기 힘들다. 이것을 **cold start problem** 이라고 부른다. 



### 컨텐츠 기반 필터링 (Content Based Filtering, CBF)

위의 cold start problem을 해결할 수 있는 것이 컨텐츠 기반 필터링이다. 컨텐츠 기반 필터링은 대상 자체의 특성을 바탕으로 추천하는 방법론이다. 아이템이 가지고 있는 정보들을 바탕으로 분석한다. 각 아이템들이 가지고 있는 메타 정보들을 특징으로 활용하므로 새로이 추가되는 아이템일지라도 해당 아이템의 메타 정보를 기반으로 하여 특징을 뽑아내고 기존의 아이템목록에서 유사도가 높은 아이템을 추출해 낼 수 있다.

컨텐츠 기반 필터링은 아이템 자체에서 정보를 뽑아내기 때문에 딥러닝이 개입할 여지가 많다. 과거에는 손으로 만든 특징(features) 들을 모아서 사용하기도 했었는데 컴퓨터성능이 좋아지고 데이터가 훨씬 많아진 오늘날에는 손으로 피쳐를 만들기보다는 딥러닝을 많이 사용하고 있다. 

컬럼을 정하고 -> 벡터를 만들고 -> Cosine similarity를 구함 -> 관련 컨텐츠를 찾아냄 



